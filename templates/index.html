<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Hybrid Pro Terminal</title>
<!-- Add your CSS styles here for beautiful layout -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
/* Basic styles for layout and responsiveness */
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #1e3c72, #2a5298);
  color: #fff;
  margin: 0;
  padding: 20px;
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.title {
  font-size: 24px;
  font-weight: bold;
}
.settings-btn {
  background: #ffffff20;
  border: none;
  padding: 10px 15px;
  border-radius: 8px;
  cursor: pointer;
  color: #fff;
  font-size: 16px;
  transition: background 0.3s;
}
.settings-btn:hover {
  background: #ffffff40;
}
#settingsPanel {
  display: none;
  background: #ffffff20;
  padding: 20px;
  border-radius: 12px;
  margin-top: 10px;
}
.section {
  margin-bottom: 15px;
}
.label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}
input[type=text], select {
  width: 100%;
  padding: 8px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
}
button {
  padding: 10px 15px;
  margin-top: 10px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.3s;
}
button:hover {
  background: #ffffff30;
}
#resultsContainer {
  margin-top: 20px;
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
}
.card {
  background: rgba(255,255,255,0.1);
  border-radius: 12px;
  padding: 15px;
  flex: 1 1 300px;
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
.card h3 {
  margin-top: 0;
}
#download-buttons {
  margin-top: 10px;
}
.download-btn {
  background: linear-gradient(to right, #4CAF50, #81C784);
  color: #fff;
  margin-right: 10px;
}
</style>
</head>
<body>

<div class="header">
  <div class="title">ðŸš€ Hybrid 17 Pro Terminal</div>
  <button class="settings-btn" onclick="toggleSettings()"><i class="fas fa-cog"></i> Settings</button>
</div>

<div id="settingsPanel">
  <div class="section">
    <div class="label">Backend URL</div>
    <input type="text" id="backendUrl" placeholder="https://your-railway-app.up.railway.app"/>
  </div>
  <div class="section">
    <div class="label">API Keys</div>
    <div><input type="text" id="eodhdKey" placeholder="EODHD API Key"/></div>
    <div><input type="text" id="databentoKey" placeholder="Databento API Key"/></div>
    <div><input type="text" id="polygonKey" placeholder="Polygon API Key"/></div>
    <div><input type="text" id="thetaKey" placeholder="Theta Data API Key"/></div>
  </div>
  <button onclick="saveSettings()">Save Keys & URL</button>
  <button onclick="testConnection()">Test Connection</button>
</div>

<div class="section">
  <label for="tickerSelect"><strong>Select Ticker:</strong></label>
  <select id="tickerSelect" onchange="loadMetadata()">
    <option value="SPX">SPX</option>
    <option value="SPY">SPY</option>
    <option value="QQQ">QQQ</option>
    <option value="VIX">VIX</option>
    <option value="TLT">TLT</option>
    <option value="NVDA">NVDA</option>
    <option value="MSFT">MSFT</option>
    <option value="META">META</option>
    <option value="GOOGL">GOOGL</option>
    <option value="AMZN">AMZN</option>
    <option value="TSLA">TSLA</option>
  </select>
</div>

<div id="downloadButtons" style="margin-top:10px; display:none;">
  <button class="download-btn" onclick="downloadCSV()">Download CSV</button>
  <button class="download-btn" onclick="downloadJSON()">Download JSON</button>
</div>

<div id="resultsContainer"></div>

<script>
let settings = {
  backendUrl: localStorage.getItem('backendUrl') || '',
  eodhdKey: localStorage.getItem('eodhdKey') || '',
  databentoKey: localStorage.getItem('databentoKey') || '',
  polygonKey: localStorage.getItem('polygonKey') || '',
  thetaKey: localStorage.getItem('thetaKey') || ''
};
let fetchedData = {};  // To hold data for download

function toggleSettings() {
  document.getElementById('settingsPanel').style.display = 
    document.getElementById('settingsPanel').style.display === 'none' ? 'block' : 'none';
}

function saveSettings() {
  settings.backendUrl = document.getElementById('backendUrl').value.trim();
  settings.eodhdKey = document.getElementById('eodhdKey').value.trim();
  settings.databentoKey = document.getElementById('databentoKey').value.trim();
  settings.polygonKey = document.getElementById('polygonKey').value.trim();
  settings.thetaKey = document.getElementById('thetaKey').value.trim();

  localStorage.setItem('backendUrl', settings.backendUrl);
  localStorage.setItem('eodhdKey', settings.eodhdKey);
  localStorage.setItem('databentoKey', settings.databentoKey);
  localStorage.setItem('polygonKey', settings.polygonKey);
  localStorage.setItem('thetaKey', settings.thetaKey);
  alert('Settings saved!');
}

// Load saved settings on page load
window.onload = loadSettings;

function loadSettings() {
  document.getElementById('backendUrl').value = settings.backendUrl;
  document.getElementById('eodhdKey').value = settings.eodhdKey;
  document.getElementById('databentoKey').value = settings.databentoKey;
  document.getElementById('polygonKey').value = settings.polygonKey;
  document.getElementById('thetaKey').value = settings.thetaKey;
}

function testConnection() {
  alert('Implement connection test based on backend API');
}

// Load metadata based on selected ticker
function loadMetadata() {
  // Implement API call to fetch metadata or prepare for fetch commands
  // For now, just log selected ticker
  console.log('Selected ticker:', document.getElementById('tickerSelect').value);
}

// Example: fetch and display data
async function fetchData() {
  const ticker = document.getElementById('tickerSelect').value;
  const backend = settings.backendUrl || '';

  // Example fetch for EODHD
  const response = await fetch(`${backend}/fetch_eodhd`, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ticker})
  });
  const data = await response.json();
  // Save for download
  fetchedData['eodhd'] = data;
  displayResults(data);
  showDownloadButtons();
}
function displayResults(data) {
  const container = document.getElementById('resultsContainer');
  container.innerHTML = '';
  // Generate cards or tables for data (simplified here)
  let card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `<h3>Results for ${document.getElementById('tickerSelect').value}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
  container.appendChild(card);
}

// Show download buttons
function showDownloadButtons() {
  document.getElementById('downloadButtons').style.display='block';
}

function downloadCSV() {
  if (!fetchedData['eodhd']) return;
  const json = fetchedData['eodhd'];
  const csv = jsonToCSV(json);
  downloadFile(csv, 'data.csv', 'text/csv');
}

function downloadJSON() {
  if (!fetchedData['eodhd']) return;
  const jsonStr = JSON.stringify(fetchedData['eodhd'], null, 2);
  downloadFile(jsonStr, 'data.json', 'application/json');
}

function downloadFile(content, filename, mime) {
  const blob = new Blob([content], {type: mime});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

function jsonToCSV(json) {
  const array = Array.isArray(json) ? json : [json];
  const keys = Object.keys(array[0] || {});
  const csvContent = [
    keys.join(','),
    ...array.map(row => keys.map(k => `"${row[k] || ''}"`).join(','))
  ].join('\n');
  return csvContent;
}
</script>

</body>
</html>
